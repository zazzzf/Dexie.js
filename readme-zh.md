<div class="blog-content-box">
    <div class="article-header-box">
        <div class="article-header">
            <div class="article-title-box">
                <h1 class="title-article" id="articleContentId">基于indexDB的Dexie数据库</h1>
            </div>
            <div class="article-info-box">
                <div class="article-bar-top">
                    <img class="article-type-img" src="https://csdnimg.cn/release/blogv2/dist/pc/img/original.png" alt="" style="vertical-align: bottom;">
                    <div class="bar-content">
                    <a class="follow-nickName " href="https://blog.csdn.net/qq_36587420" target="_blank" rel="noopener">_El-切图仔</a>
                    <span class="time">2020-03-25 23:35:59</span>
                    <img class="article-read-img article-heard-img" src="https://csdnimg.cn/release/blogv2/dist/pc/img/articleReadEyes.png" alt="" style="vertical-align: bottom;">
                    <span class="read-count">5040</span>
                    <span>
                        <img class="article-collect-img article-heard-img un-collect-status isdefault" style="vertical-align: bottom;" src="https://csdnimg.cn/release/blogv2/dist/pc/img/tobarCollect.png" alt="">
                        <img class="article-collect-img article-heard-img collect-status isactive" style="vertical-align: bottom;" src="https://csdnimg.cn/release/blogv2/dist/pc/img/tobarCollectionActive.png" alt="">
                        <span class="name">收藏</span>
                        <span class="get-collection">
                            16
                        </span>
                    </span>
                    </div>
                </div>
                <div class="blog-tags-box">
                    <div class="tags-box artic-tag-box">
                            <span class="label">文章标签：</span>
                                <a data-report-click="{&quot;mod&quot;:&quot;popu_626&quot;,&quot;spm&quot;:&quot;1001.2101.3001.4223&quot;,&quot;strategy&quot;:&quot;javascript&quot;,&quot;ab&quot;:&quot;new&quot;}" class="tag-link" href="https://www.csdn.net/tags/OtDaQg2sNzExLWJsb2cO0O0O.html" target="_blank" rel="noopener">javascript</a>
                                <a data-report-click="{&quot;mod&quot;:&quot;popu_626&quot;,&quot;spm&quot;:&quot;1001.2101.3001.4223&quot;,&quot;strategy&quot;:&quot;前端&quot;,&quot;ab&quot;:&quot;new&quot;}" class="tag-link" href="https://www.csdn.net/tags/MtTaEg0sMzc5NzAtYmxvZwO0O0OO0O0O.html" target="_blank" rel="noopener">前端</a>
                                <a data-report-click="{&quot;mod&quot;:&quot;popu_626&quot;,&quot;spm&quot;:&quot;1001.2101.3001.4223&quot;,&quot;strategy&quot;:&quot;数据库&quot;,&quot;ab&quot;:&quot;new&quot;}" class="tag-link" href="https://www.csdn.net/tags/NtzaUgysMTg1NC1ibG9n.html" target="_blank" rel="noopener">数据库</a>
                    </div>
                </div>
                <div class="slide-content-box">
                    <div class="article-copyright">
                        <div class="creativecommons">
                            版权声明：本文为博主原创文章，遵循<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> CC 4.0 BY-SA </a>版权协议，转载请附上原文出处链接和本声明。
                        </div>
                        <div class="article-source-link">
                            本文链接：<a href="https://blog.csdn.net/qq_36587420/article/details/105058830" target="_blank">https://blog.csdn.net/qq_36587420/article/details/105058830</a>
                        </div>
                    </div>
                </div>
                <div class="operating">
                    <span>版权</span>
                </div>
            </div>
        </div>
    </div>
    <div id="csdn-shop-window-top" class="csdn-shop-window-common" style="margin-top: 18px; padding: 0px; display: none;"></div>
    <article class="baidu_pl">
        <div id="article_content" class="article_content clearfix">
        <link rel="stylesheet" href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/ck_htmledit_views-b5506197d8.css">
                <div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block"></path>
                    </svg>
                    <p style="margin-top: 16px; margin-bottom: 16px;"></p><div class="toc">
 <h3><span></span><span></span>Dexie</h3>
 <ul><li><div style="clear: both;"><a href="#Dexie_2" target="_self">什么是Dexie？</a></div></li><li><ul><li><div style="clear: both;"><a href="#_14" target="_self">性能</a></div></li></ul>
  </li><li><div style="clear: both;"><a href="#_16" target="_self">安装及使用</a></div></li><li><ul><li><div style="clear: both;"><a href="#1_17" target="_self">1.安装</a></div></li><li><div style="clear: both;"><a href="#2_28" target="_self">2.使用</a></div></li></ul>
  </li><li><div style="clear: both;"><a href="#API_55" target="_self">API</a></div></li><li><ul><li><div style="clear: both;"><a href="#_56" target="_self">创建数据库</a></div></li><li><ul><li><div style="clear: both;"><a href="#_66" target="_self">语法</a></div></li><li><ul><li><div style="clear: both;"><a href="#_75" target="_self">多条目索引</a></div></li><li><ul><li><div style="clear: both;"><a href="#_96" target="_self">如何查询多条目索引？</a></div></li><li><div style="clear: both;"><a href="#distinct_107" target="_self">distinct()运算符</a></div></li><li><div style="clear: both;"><a href="#_150" target="_self">局限性</a></div></li></ul>
     </li><li><div style="clear: both;"><a href="#_160" target="_self">复合索引</a></div></li></ul>
   </li></ul>
   </li><li><div style="clear: both;"><a href="#upgrade_182" target="_self">升级（upgrade）</a></div></li><li><div style="clear: both;"><a href="#_208" target="_self">类绑定</a></div></li><li><div style="clear: both;"><a href="#_226" target="_self">新增数据</a></div></li><li><ul><li><div style="clear: both;"><a href="#add_237" target="_self">add()</a></div></li><li><div style="clear: both;"><a href="#tablebulkAdditems_keys_options_247" target="_self">table.bulkAdd(items, keys?, options?);</a></div></li></ul>
   </li><li><div style="clear: both;"><a href="#_268" target="_self">更新数据</a></div></li><li><ul><li><div style="clear: both;"><a href="#tableputitem_key_289" target="_self">table.put(item, [key])</a></div></li><li><div style="clear: both;"><a href="#tablebulkPutitems_keys_options_298" target="_self">table.bulkPut(items, keys?, options?)</a></div></li><li><div style="clear: both;"><a href="#tableupdatekey_changes_304" target="_self">table.update(key, changes)</a></div></li><li><div style="clear: both;"><a href="#collection_311" target="_self">collection</a></div></li><li><ul><li><div style="clear: both;"><a href="#Methods_314" target="_self">Methods(方法)</a></div></li><li><ul><li><div style="clear: both;"><a href="#and_315" target="_self">and()</a></div></li><li><div style="clear: both;"><a href="#clone_318" target="_self">clone()</a></div></li><li><div style="clear: both;"><a href="#count_320" target="_self">count()</a></div></li><li><div style="clear: both;"><a href="#delete_323" target="_self">delete()</a></div></li><li><div style="clear: both;"><a href="#desc_326" target="_self">desc()</a></div></li><li><div style="clear: both;"><a href="#distinct_329" target="_self">distinct()</a></div></li><li><div style="clear: both;"><a href="#each_332" target="_self">each()</a></div></li><li><div style="clear: both;"><a href="#eachKey_334" target="_self">eachKey()</a></div></li><li><div style="clear: both;"><a href="#eachPrimaryKey_337" target="_self">eachPrimaryKey()</a></div></li><li><div style="clear: both;"><a href="#eachUniqueKey_340" target="_self">eachUniqueKey()</a></div></li><li><div style="clear: both;"><a href="#filter_343" target="_self">filter()</a></div></li><li><div style="clear: both;"><a href="#first_346" target="_self">first()</a></div></li><li><div style="clear: both;"><a href="#keys_349" target="_self">keys()</a></div></li><li><div style="clear: both;"><a href="#last_352" target="_self">last()</a></div></li><li><div style="clear: both;"><a href="#limit_354" target="_self">limit()</a></div></li><li><div style="clear: both;"><a href="#modify_357" target="_self">modify()</a></div></li><li><div style="clear: both;"><a href="#offset_360" target="_self">offset()</a></div></li><li><div style="clear: both;"><a href="#or_363" target="_self">or()</a></div></li><li><div style="clear: both;"><a href="#primaryKeys_366" target="_self">primaryKeys()</a></div></li><li><div style="clear: both;"><a href="#raw_369" target="_self">raw()</a></div></li><li><div style="clear: both;"><a href="#reverse_372" target="_self">reverse()</a></div></li><li><div style="clear: both;"><a href="#sortBy_375" target="_self">sortBy()</a></div></li><li><div style="clear: both;"><a href="#toArray_378" target="_self">toArray()</a></div></li><li><div style="clear: both;"><a href="#uniqueKeys_381" target="_self">uniqueKeys()</a></div></li><li><div style="clear: both;"><a href="#until_384" target="_self">until()</a></div></li></ul>
    </li></ul>
    </li><li><div style="clear: both;"><a href="#collectionmodifychanges_386" target="_self">collection.modify(changes)</a></div></li></ul>
   </li><li><div style="clear: both;"><a href="#_401" target="_self">删除数据</a></div></li><li><ul><li><div style="clear: both;"><a href="#Tabledelete_407" target="_self">Table.delete()</a></div></li><li><div style="clear: both;"><a href="#TablebulkDelete_411" target="_self">Table.bulkDelete()</a></div></li><li><div style="clear: both;"><a href="#Collectiondelete_424" target="_self">Collection.delete()</a></div></li></ul>
   </li><li><div style="clear: both;"><a href="#_439" target="_self">查询数据</a></div></li><li><ul><li><div style="clear: both;"><a href="#Tablewhere_504" target="_self">Table.where()</a></div></li><li><div style="clear: both;"><a href="#WhereClause_522" target="_self">WhereClause</a></div></li><li><ul><li><div style="clear: both;"><a href="#Methods_525" target="_self">Methods（方法）</a></div></li><li><ul><li><div style="clear: both;"><a href="#_above_527" target="_self">- above()</a></div></li><li><div style="clear: both;"><a href="#_aboveOrEqual_529" target="_self">- aboveOrEqual()</a></div></li><li><div style="clear: both;"><a href="#_anyOf_531" target="_self">- anyOf()</a></div></li><li><div style="clear: both;"><a href="#_anyOfIgnoreCase_533" target="_self">- anyOfIgnoreCase()</a></div></li><li><div style="clear: both;"><a href="#_below_535" target="_self">- below()</a></div></li><li><div style="clear: both;"><a href="#_belowOrEqual_537" target="_self">- belowOrEqual()</a></div></li><li><div style="clear: both;"><a href="#_between_539" target="_self">- between()</a></div></li><li><div style="clear: both;"><a href="#_equals_541" target="_self">- equals()</a></div></li><li><div style="clear: both;"><a href="#_equalsIgnoreCase_543" target="_self">- equalsIgnoreCase()</a></div></li><li><div style="clear: both;"><a href="#_inAnyRange_545" target="_self">- inAnyRange()</a></div></li><li><div style="clear: both;"><a href="#_noneOf_547" target="_self">- noneOf()</a></div></li><li><div style="clear: both;"><a href="#_notEqual_549" target="_self">- notEqual()</a></div></li><li><div style="clear: both;"><a href="#_startsWith_551" target="_self">- startsWith()</a></div></li><li><div style="clear: both;"><a href="#_startsWithAnyOf_553" target="_self">- startsWithAnyOf()</a></div></li><li><div style="clear: both;"><a href="#_startsWithIgnoreCase_555" target="_self">- startsWithIgnoreCase()</a></div></li><li><div style="clear: both;"><a href="#_startsWithAnyOfIgnoreCase_557" target="_self">- startsWithAnyOfIgnoreCase()</a></div></li></ul>
    </li></ul>
   </li></ul>
   </li><li><div style="clear: both;"><a href="#_560" target="_self">存储二进制数据</a></div></li><li><div style="clear: both;"><a href="#indexDB_20_578" target="_self">索引二进制数据（indexDB 2.0）</a></div></li><li><div style="clear: both;"><a href="#Transaction_609" target="_self">事务（Transaction）</a></div></li></ul>
 </li></ul></div><p style="margin-top: 16px; margin-bottom: 16px;"></p> 
<h1><span></span><span></span><span></span>什么是Dexie？</h1> 
<p style="margin-top: 16px; margin-bottom: 16px;"><strong>A Minimalistic Wrapper for IndexedDB</strong><br> 这是官网的一句话翻译过来就是<strong>IndexedDB 的一个最小化包装</strong></p> 
<p style="margin-top: 16px; margin-bottom: 16px;">Dexie使用本机IndexedDB API解决了三个主要问题：</p> 
<ul><li><div style="clear: both;">模棱两可的错误处理</div></li><li><div style="clear: both;">不好查询</div></li><li><div style="clear: both;">代码复杂性</div></li></ul> 
<p style="margin-top: 16px; margin-bottom: 16px;">有使用过indexDB的同学就知道其查询语句的麻烦特别是多条件查询的时候<br> 这是Dexie的官网<a href="https://dexie.org/">https://dexie.org/</a>，</p> 
<h2><span></span><span></span><span></span>性能</h2> 
<p style="margin-top: 16px; margin-bottom: 16px;">Dexie表现出色。 它的<a href="https://dexie.org/docs/Table/Table.bulkPut%28%29">批量方法</a>利用了IndexedDB中一个鲜为人知的特性，可以在不收听每个onsuccess事件的情况下存储东西。 这样可以最大限度地提高性能。</p> 
<h1><span></span><span></span><span></span>安装及使用</h1> 
<h2><span></span><span></span><span></span>1.安装</h2> 
<p style="margin-top: 16px; margin-bottom: 16px;">模块化开发下可以使用npm/cnpm/yarn安装</p> 
<pre class="prettyprint"><code class="has-numbering" style="position: unset;">npm install dexie
<div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li></ul></pre> 
<p style="margin-top: 16px; margin-bottom: 16px;">而想直接引入使用的也可以使用以下方法</p> 
<pre class="prettyprint"><code class="prism language-html has-numbering" style="position: unset;"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><a href="https://unpkg.com/dexie@latest/dist/dexie.js" target="_blank">https://unpkg.com/dexie@latest/dist/dexie.js</a><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li></ul></pre> 
<h2><span></span><span></span><span></span>2.使用</h2> 
<p style="margin-top: 16px; margin-bottom: 16px;">这里我采用了一下官网的一个简单的例子</p> 
<pre class="prettyprint"><code class="prism language-javascript has-numbering" style="position: unset;"><span class="token comment">//模块化开发下需要引入该组件</span><span class="token keyword">import</span> Dexie <span class="token keyword">from</span> <span class="token string">'dexie'</span><span class="token comment">//创建一个数据库 若数据库已存在则为打开 </span><span class="token comment">//打开数据库时，会判断当前version值是否大于已经存在的version值，若大于则会upgrade即升到最高版本</span><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dexie</span><span class="token punctuation">(</span><span class="token string">"test_db"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

db<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stores</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
     student<span class="token punctuation">:</span> <span class="token string">'name,age'</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 db<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//写入一些数据</span>
db<span class="token punctuation">.</span>student<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">"小明"</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//当数据存储完成后 我们可以读取它</span>
    <span class="token keyword">return</span> db<span class="token punctuation">.</span>student<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'小明'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"我是小明,今年 "</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">//最后别忘了抓住任何可能发生在上面的代码块。</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"error: "</span> <span class="token operator">+</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
   db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">2</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">3</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">4</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">5</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">6</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">7</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">8</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">9</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">10</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">11</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">12</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">13</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">14</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">15</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">16</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">17</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">18</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">19</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">20</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">21</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">22</div></li></ul></pre> 
<h1><span></span><span></span><span></span>API</h1> 
<h2><span></span><span></span><span></span>创建数据库</h2> 
<pre class="prettyprint"><code class="prism language-javascript has-numbering" style="position: unset;"><span class="token comment">//注意：不要像在SQL中那样声明所有列。只声明要索引的属性，即要在where（…）查询中使用的属性。</span><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dexie</span><span class="token punctuation">(</span><span class="token string">"MyDatabase"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stores</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    friends<span class="token punctuation">:</span> <span class="token string">"++id, name, age, *tags"</span><span class="token punctuation">,</span>
    gameSessions<span class="token punctuation">:</span> <span class="token string">"id, score"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">2</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">3</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">4</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">5</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">6</div></li></ul></pre> 
<h3><span></span><span></span><span></span>语法</h3> 
<div class="table-box"><table><thead><tr><td><div style="font-weight: bold; text-align: center;"></div></td><td><div style="font-weight: bold; text-align: center;"></div></td></tr></thead><tbody><tr><td>++</td><td>自动递增主键</td></tr><tr><td>&amp;</td><td>唯一主键</td></tr><tr><td>*</td><td>多条目索引</td></tr><tr><td>+</td><td>复合索引</td></tr></tbody></table></div><p style="margin-top: 16px; margin-bottom: 16px;">第一第二栏目就不说了很好理解，这里主要说明一下第三第四栏</p> 
<h4><span></span>多条目索引</h4> 
<pre class="prettyprint"><code class="prism language-javascript has-numbering" style="position: unset;"><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dexie</span><span class="token punctuation">(</span><span class="token string">'dbname'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stores</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  books<span class="token punctuation">:</span> <span class="token string">'id, author, name, *categories'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">2</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">3</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">4</div></li></ul></pre> 
<p style="margin-top: 16px; margin-bottom: 16px;">在本示例中，书籍可以按多个类别进行分类。这是通过让book对象具有一个名为“categories”的数组属性来实现的，该数组属性包含类别字符串。见以下示例：</p> 
<pre class="prettyprint"><code class="prism language-javascript has-numbering" style="position: unset;">db<span class="token punctuation">.</span>books<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  name<span class="token punctuation">:</span> <span class="token string">'Under the Dome'</span><span class="token punctuation">,</span> 
  author<span class="token punctuation">:</span> <span class="token string">'Stephen King'</span><span class="token punctuation">,</span>
  categories<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'sci-fi'</span><span class="token punctuation">,</span> <span class="token string">'thriller'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">2</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">3</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">4</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">5</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">6</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">7</div></li></ul></pre> 
<p style="margin-top: 16px; margin-bottom: 16px;">在示例中，我们添加了一本包含多个类别“科幻”和“惊悚”的书。注意，不仅字符串可以放入数组，而且任何可索引类型都是有效的。</p> 
<h5><span></span>如何查询多条目索引？</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">所有where子句运算符都可用于查询多条目索引对象。但是，运算符的行为不像普通索引那样直观。例如，应该使用WhereClause.equals（）运算符查询属于特定类别的书籍，而更具语义的名称可能是contains（）。这样做的原因是要映射indexedDB在本机上的工作方式，还允许使用任何运算符，而不将多条目索引绑定到某些运算符。</p> 
<pre class="prettyprint"><code class="prism language-javascript has-numbering" style="position: unset;"><span class="token comment">// 查询所有科幻书籍:</span><span class="token keyword">function</span> <span class="token function">getSciFiBooks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> db<span class="token punctuation">.</span>books
    <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'categories'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">'sci-fi'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toArray</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">2</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">3</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">4</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">5</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">6</div></li></ul></pre> 
<h5><span></span>distinct()运算符</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">查询多条目索引时，如果同一项有多个索引匹配，则可能会得到同一对象的多个结果。因此，在对多条目索引的查询中始终使用Collection.distinct（）是一个很好的做法。</p> 
<pre class="prettyprint"><code class="prism language-javascript has-numbering" style="position: unset;"><span class="token comment">// 定义数据库</span><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dexie</span><span class="token punctuation">(</span><span class="token string">'dbname'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stores</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  books<span class="token punctuation">:</span> <span class="token string">'id, author, name, *categories'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 插入一本多类别的书</span>
db<span class="token punctuation">.</span>books<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  name<span class="token punctuation">:</span> <span class="token string">'Under the Dome'</span><span class="token punctuation">,</span> 
  author<span class="token punctuation">:</span> <span class="token string">'Stephen King'</span><span class="token punctuation">,</span>
  categories<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'sci-fi'</span><span class="token punctuation">,</span> <span class="token string">'thriller'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 查询所有科幻书籍:</span><span class="token keyword">function</span> <span class="token function">getSciFiBooks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> db<span class="token punctuation">.</span>books
    <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'categories'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">'sci-fi'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toArray</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// 查询所有科幻或浪漫书籍:</span><span class="token keyword">function</span> <span class="token function">getSciFiOrRomanceBooks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> db<span class="token punctuation">.</span>books
    <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'categories'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anyOf</span><span class="token punctuation">(</span><span class="token string">'sci-fi'</span><span class="token punctuation">,</span> <span class="token string">'romance'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 筛选掉重复的数据</span>
    <span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// 复杂查询</span><span class="token keyword">function</span> <span class="token function">complexQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> db<span class="token punctuation">.</span>books
    <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'categories'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWithAnyOfIgnoreCase</span><span class="token punctuation">(</span><span class="token string">'sci'</span><span class="token punctuation">,</span> <span class="token string">'ro'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token string">'author'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">'stephen king'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">2</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">3</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">4</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">5</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">6</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">7</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">8</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">9</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">10</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">11</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">12</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">13</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">14</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">15</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">16</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">17</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">18</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">19</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">20</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">21</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">22</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">23</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">24</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">25</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">26</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">27</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">28</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">29</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">30</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">31</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">32</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">33</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">34</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">35</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">36</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">37</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">38</div></li></ul></pre> 
<h5><span></span>局限性</h5> 
<ul><li><div style="clear: both;">复合索引不能标记为多条目。其局限性在于indexedDB本身。</div></li><li><div style="clear: both;">不能将主键标记为MultiEntry。</div></li></ul> 
<p style="margin-top: 16px; margin-bottom: 16px;">以下浏览器不支持多条目索引：</p> 
<ul><li><div style="clear: both;">ie10 、11</div></li><li><div style="clear: both;">基于非chromium的Microsoft Edge浏览器</div></li><li><div style="clear: both;">Safari 8, 9.</div></li></ul> 
<h4><span></span>复合索引</h4> 
<p style="margin-top: 16px; margin-bottom: 16px;">复合索引是基于多个键路径的索引。它可以有效地为一个索引中的多个属性建立索引，以方便地找到两个键的组合及其值的存在性。</p> 
<p style="margin-top: 16px; margin-bottom: 16px;">定义架构时必须指定复合索引：</p> 
<pre class="prettyprint"><code class="prism language-javascript has-numbering" style="position: unset;"><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dexie</span><span class="token punctuation">(</span><span class="token string">'dbname'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stores</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    people<span class="token punctuation">:</span> <span class="token string">'id, [firstName+lastName]'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">2</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">3</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">4</div></li></ul></pre> 
<p style="margin-top: 16px; margin-bottom: 16px;">在上面的示例中，firstName和lastName属性中包含有效键的记录将被索引。如果存储了具有属性{firstName:‘foo’，lastName:‘bar’}的对象，则可以使用以下方法有效地查找该对象：</p> 
<pre class="prettyprint"><code class="prism language-javascript has-numbering" style="position: unset;">db<span class="token punctuation">.</span>people<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'[firstName+lastName]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">//或者下面这样</span>
db<span class="token punctuation">.</span>people<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>firstName<span class="token punctuation">:</span> <span class="token string">'foo'</span><span class="token punctuation">,</span> lastName<span class="token punctuation">:</span> <span class="token string">'bar'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>`
<div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">2</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">3</div></li></ul></pre> 
<p style="margin-top: 16px; margin-bottom: 16px;">第二种写法是一个特例，它只在Dexie&gt;=2.0中工作，并且可以通过多个属性进行匹配，无论您的浏览器是否支持复合查询。</p> 
<p style="margin-top: 16px; margin-bottom: 16px;">附赠官网的<a href="https://dexie.org/docs/Version/Version.stores%28%29">语法文档</a></p> 
<h2><span></span><span></span><span></span>升级（upgrade）</h2> 
<pre class="prettyprint"><code class="prism language-javascript has-numbering" style="position: unset;">db<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stores</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    friends<span class="token punctuation">:</span> <span class="token string">"++id,name,age,*tags"</span><span class="token punctuation">,</span>
    gameSessions<span class="token punctuation">:</span> <span class="token string">"id,score"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

db<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stores</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    friends<span class="token punctuation">:</span> <span class="token string">"++id, [firstName+lastName], yearOfBirth, *tags"</span><span class="token punctuation">,</span> <span class="token comment">// 更改索引</span>
    gameSessions<span class="token punctuation">:</span> <span class="token keyword">null</span> <span class="token comment">// Delete 对象仓库</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">upgrade</span><span class="token punctuation">(</span>tx <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 仅当安装了低于2的version时才会执行</span>
    <span class="token keyword">return</span> tx<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">"friends"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modify</span><span class="token punctuation">(</span>friend <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        friend<span class="token punctuation">.</span>firstName <span class="token operator">=</span> friend<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        friend<span class="token punctuation">.</span>lastName <span class="token operator">=</span> friend<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        friend<span class="token punctuation">.</span>birthDate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> friend<span class="token punctuation">.</span>age<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">delete</span> friend<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
        <span class="token keyword">delete</span> friend<span class="token punctuation">.</span>age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">2</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">3</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">4</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">5</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">6</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">7</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">8</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">9</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">10</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">11</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">12</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">13</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">14</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">15</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">16</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">17</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">18</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">19</div></li></ul></pre> 
<p style="margin-top: 16px; margin-bottom: 16px;">附上有关<a href="https://dexie.org/docs/Tutorial/Design#database-versioning">数据库版本控制</a>的详细信息</p> 
<h2><span></span><span></span><span></span>类绑定</h2> 
<pre class="prettyprint"><code class="prism language-javascript has-numbering" style="position: unset;"><span class="token keyword">class</span> <span class="token class-name">Friend</span> <span class="token punctuation">{</span>
    <span class="token comment">// Prototype method</span>
    <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> db<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 只保存自己的 props.</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Prototype property</span>
    <span class="token keyword">get</span> <span class="token function">age</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">moment</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">diff</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>birthDate<span class="token punctuation">,</span> <span class="token string">'years'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">}</span>

db<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">mapToClass</span><span class="token punctuation">(</span>Friend<span class="token punctuation">)</span><span class="token punctuation">;</span><div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">2</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">3</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">4</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">5</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">6</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">7</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">8</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">9</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">10</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">11</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">12</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">13</div></li></ul></pre> 
<h2><span></span><span></span><span></span>新增数据</h2> 
<pre class="prettyprint"><code class="prism language-javascript has-numbering" style="position: unset;"><span class="token keyword">await</span> db<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">"Josephine"</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">21</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//or</span><span class="token keyword">await</span> db<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">bulkAdd</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">"Foo"</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">31</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">"Bar"</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">32</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">2</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">3</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">4</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">5</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">6</div></li></ul></pre> 
<h3><span></span><span></span><span></span>add()</h3> 
<div class="table-box"><table><thead><tr><td><div style="font-weight: bold; text-align: center;">item</div></td><td><div style="font-weight: bold; text-align: center;">要添加的对象</div></td><td><div style="font-weight: bold; text-align: center;"></div></td></tr></thead><tbody><tr><td>key</td><td>主键</td><td>option</td></tr></tbody></table></div><p style="margin-top: 16px; margin-bottom: 16px;">注意<br> 将给定对象添加到存储。如果已经存在具有相同主键的对象，则操作将失败，并将使用错误对象调用返回的promise catch（）回调。如果操作成功，则返回的promise then（）回调将接收对象存储区上的add请求的结果，即插入对象的id。</p> 
<p style="margin-top: 16px; margin-bottom: 16px;">只有当表使用非入站键时，才必须使用可选的第二个键参数。如果在具有入站密钥的表上提供密钥参数，则操作将失败，返回的承诺将被拒绝。</p> 
<h3><span></span><span></span><span></span>table.bulkAdd(items, keys?, options?);</h3> 
<div class="table-box"><table><thead><tr><td><div style="font-weight: bold; text-align: center;">item</div></td><td><div style="font-weight: bold; text-align: center;">要添加的对象数组</div></td></tr></thead><tbody><tr><td>keys (非必填)</td><td>对应于给定项数组的主键数组</td></tr><tr><td>option(非必填)</td><td>{allKeys?: boolean} 如果指定{allKeys:true}，则返回值将是结果主键的数组，而不是上一次添加的主键。如果表使用入站键，则可以将选项作为第二个参数提供。API将知道第二个参数是通过类型检查表示选项还是键数组。</td></tr></tbody></table></div><p style="margin-top: 16px; margin-bottom: 16px;">何时使用keys参数</p> 
<ul><li><div style="clear: both;">如果主键是入站的，则不能提供keys参数。</div></li><li><div style="clear: both;">如果主键是非入站但自动递增的，则keys参数是可选的。</div></li><li><div style="clear: both;">如果主键是非入站和非自动递增的，那么keys参数是必需的。</div></li></ul> 
<pre class="prettyprint"><code class="prism language-javascript has-numbering" style="position: unset;"><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dexie</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stores</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    tableWithInboundKeys<span class="token punctuation">:</span> <span class="token string">"id,x,y,z"</span><span class="token punctuation">,</span> <span class="token comment">// 不能提供 "keys"</span>
    tableWithAutoIncNonInbound<span class="token punctuation">:</span> <span class="token string">"++,x,y,x"</span><span class="token punctuation">,</span> <span class="token comment">// 可选 "keys"</span>
    tableWithoutInboundKeys<span class="token punctuation">:</span> <span class="token string">",x,y,z"</span> <span class="token comment">// 必需提供 "keys"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">2</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">3</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">4</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">5</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">6</div></li></ul></pre> 
<p style="margin-top: 16px; margin-bottom: 16px;">如果有大量对象要添加到对象存储中，那么bulkAdd（）比在循环中执行add（）要快一点。</p> 
<h2><span></span><span></span><span></span>更新数据</h2> 
<pre class="prettyprint"><code class="prism language-javascript has-numbering" style="position: unset;"><span class="token keyword">await</span> db<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>id<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">"Foo"</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">33</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//or</span><span class="token keyword">await</span> db<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">bulkPut</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>id<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">"Foo2"</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">34</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>id<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">"Bar2"</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">44</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">2</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">3</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">4</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">5</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">6</div></li></ul></pre> 
<pre class="prettyprint"><code class="prism language-javascript has-numbering" style="position: unset;"><span class="token keyword">await</span> db<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">"Bar"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">await</span> db<span class="token punctuation">.</span>customers
    <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">inAnyRange</span><span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">Infinity</span><span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">modify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>discount<span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">2</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">3</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">4</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">5</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">6</div></li></ul></pre> 
<h3><span></span><span></span><span></span>table.put(item, [key])</h3> 
<div class="table-box"><table><thead><tr><td><div style="font-weight: bold; text-align: center;">item</div></td><td><div style="font-weight: bold; text-align: center;">要添加的对象</div></td><td><div style="font-weight: bold; text-align: center;"></div></td></tr></thead><tbody><tr><td>key</td><td>主键</td><td>option</td></tr></tbody></table></div><p style="margin-top: 16px; margin-bottom: 16px;">注意<br> 如果已存在具有相同主键的对象，则该对象将替换为给定对象。如果它不存在，则将添加它。</p> 
<p style="margin-top: 16px; margin-bottom: 16px;">只有当表使用非入站键时，才必须使用可选的第二个键参数。如果在具有入站密钥的表上提供密钥参数，则操作将失败，返回的rejection promise。</p> 
<h3><span></span><span></span><span></span>table.bulkPut(items, keys?, options?)</h3> 
<div class="table-box"><table><thead><tr><td><div style="font-weight: bold; text-align: center;">item</div></td><td><div style="font-weight: bold; text-align: center;">要put的对象数组</div></td></tr></thead><tbody><tr><td>keys (非必填)</td><td>对应于给定项数组的主键数组</td></tr><tr><td>option(非必填)</td><td>{allKeys?: boolean} 如果指定{allKeys:true}，则返回值将是结果主键的数组，而不是上一次添加的主键。如果表使用入站键，则可以将选项作为第二个参数提供。API将知道第二个参数是通过类型检查表示选项还是键数组。</td></tr></tbody></table></div><h3><span></span><span></span><span></span>table.update(key, changes)</h3> 
<div class="table-box"><table><thead><tr><td><div style="font-weight: bold; text-align: center;">key</div></td><td><div style="font-weight: bold; text-align: center;">主键</div></td></tr></thead><tbody><tr><td>changes</td><td>对象，该对象包含要更改的每个属性的键路径。</td></tr></tbody></table></div><p style="margin-top: 16px; margin-bottom: 16px;">返回值：0/1<br> Promise 更新记录的数量（如果对象已更新，则为1，否则为0）。结果为0的原因可能是找不到提供的密钥，或者提供的数据与现有数据相同，因此没有更新任何内容。</p> 
<h3><span></span><span></span><span></span>collection</h3> 
<p style="margin-top: 16px; margin-bottom: 16px;">表示数据库对象的集合。注意，它本身不包含任何对象。相反，它为如何执行数据库查询做了准备。调用返回Promise的方法时将执行查询，例如toArray（）、keys（）、count（）或each（）。</p> 
<h4><span></span>Methods(方法)</h4> 
<h5><span></span>and()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">将基于JS的条件添加到集合</p> 
<h5><span></span>clone()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">在进一步操作查询之前克隆该查询（不克隆数据库项）。</p> 
<h5><span></span>count()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">获取集合中的项目数</p> 
<h5><span></span>delete()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">删除集合中的所有对象</p> 
<h5><span></span>desc()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">按降序排序</p> 
<h5><span></span>distinct()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">删除具有相同主键的项的重复项</p> 
<h5><span></span>each()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">执行查询并为每个项调用函数</p> 
<h5><span></span>eachKey()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">对正在使用的索引或主键执行查询，并为每个键调用一个函数</p> 
<h5><span></span>eachPrimaryKey()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">对索引执行查询，并为对应于索引的每个主键调用函数。</p> 
<h5><span></span>eachUniqueKey()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">对正在使用的索引或主键执行查询，并为每个唯一键调用函数</p> 
<h5><span></span>filter()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">筛选对象</p> 
<h5><span></span>first()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">获取集合中的第一个项目</p> 
<h5><span></span>keys()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">检索包含集合的所有键的数组（索引键或主键取决于where（）子句）</p> 
<h5><span></span>last()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">获取集合中的最后一项</p> 
<h5><span></span>limit()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">将结果限制为给定的项目数</p> 
<h5><span></span>modify()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">使用给定的属性或函数修改集合中的所有对象。</p> 
<h5><span></span>offset()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">忽略给定偏移量前的N项并返回其余项</p> 
<h5><span></span>or()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">逻辑或运算</p> 
<h5><span></span>primaryKeys()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">检索包含集合的所有主键的数组</p> 
<h5><span></span>raw()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">不要通过阅读挂钩过滤结果</p> 
<h5><span></span>reverse()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">颠倒项目顺序。</p> 
<h5><span></span>sortBy()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">执行查询并获取结果按给定属性排序的数组</p> 
<h5><span></span>toArray()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">执行查询并获取一个数组，其结果按where（）子句中使用的索引排序</p> 
<h5><span></span>uniqueKeys()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">检索包含集合的所有唯一键（索引键或主键取决于where（）子句）的数组</p> 
<h5><span></span>until()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">忽略给定筛选器返回true后发生的项。</p> 
<h3><span></span><span></span><span></span>collection.modify(changes)</h3> 
<div class="table-box"><table><thead><tr><td><div style="font-weight: bold; text-align: center;"></div></td><td><div style="font-weight: bold; text-align: center;"></div></td></tr></thead><tbody><tr><td>changes</td><td>对象，其中包含要应用于集合中所有对象的更改。调用方可以提供函数而不是对象</td></tr></tbody></table></div><ul><li><div style="clear: both;">如果提供了对象，则每个键都是要更改的属性的路径，每个值都是要设置的新值</div></li><li><div style="clear: both;">如果提供了函数，则将为集合中的每个匹配对象调用给定函数。函数检索对象作为第一个参数。然后，函数可以修改、添加或删除对象的属性。当函数返回时，框架将用对给定对象所做的更改将其更新到数据库。</div></li></ul> 
<p style="margin-top: 16px; margin-bottom: 16px;">注意<br> 如果给定的更改是一个对象，则对象中的每个键表示一个keyPath，每个值表示要设置的新值。键路径可以是属性的名称，或者如果包含句点（.），则充当嵌套对象中属性的路径。</p> 
<p style="margin-top: 16px; margin-bottom: 16px;">如果值是函数，则将为每个对象调用该函数，以便该函数可以修改或删除对象上的任何属性。函数也可以使用this.value=otherObject将对象替换为另一个对象。最后，函数还可以通过delete this.value删除对象；请参见下面的示例。</p> 
<p style="margin-top: 16px; margin-bottom: 16px;">警告<br> Safari 10和11有一个问题，如果使用dexie@2，那么这个方法基本上会停止处理使用索引的查询（与dexie where子句一样）。Dexie@3解决了这个问题。德克西594期正在讨论这个问题</p> 
<h2><span></span><span></span><span></span>删除数据</h2> 
<pre class="prettyprint"><code class="prism language-javascript has-numbering" style="position: unset;"><span class="token keyword">await</span> db<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">await</span> db<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">bulkDelete</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">2</div></li></ul></pre> 
<h3><span></span><span></span><span></span>Table.delete()</h3> 
<div class="table-box"><table><thead><tr><td><div style="font-weight: bold; text-align: center;"></div></td><td><div style="font-weight: bold; text-align: center;"></div></td></tr></thead><tbody><tr><td>主键</td><td>要删除的对象的主键</td></tr></tbody></table></div><h3><span></span><span></span><span></span>Table.bulkDelete()</h3> 
<div class="table-box"><table><thead><tr><td><div style="font-weight: bold; text-align: center;"></div></td><td><div style="font-weight: bold; text-align: center;"></div></td></tr></thead><tbody><tr><td>keys</td><td>要删除的对象的主键数组</td></tr></tbody></table></div><pre class="prettyprint"><code class="prism language-javascript has-numbering" style="position: unset;"><span class="token keyword">const</span> oneWeekAgo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">1000</span><span class="token operator">*</span><span class="token number">24</span><span class="token operator">*</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">await</span> db<span class="token punctuation">.</span>logEntries
    <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'timestamp'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">below</span><span class="token punctuation">(</span>oneWeekAgo<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">2</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">3</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">4</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">5</div></li></ul></pre> 
<h3><span></span><span></span><span></span>Collection.delete()</h3> 
<p style="margin-top: 16px; margin-bottom: 16px;">删除查询出的数据</p> 
<p style="margin-top: 16px; margin-bottom: 16px;">成功则返回删除的数量Promise（）</p> 
<p style="margin-top: 16px; margin-bottom: 16px;">如果未能删除任何对象或回调函数中发生异常，则整个操作将失败，事务（transaction ()）将中止。</p> 
<p style="margin-top: 16px; margin-bottom: 16px;">如果捕捉到返回的承诺，事务将不会中止，并且您将收到一个包含以下属性的Dexie.mulmodifyerror对象：</p> 
<div class="table-box"><table><thead><tr><td><div style="font-weight: bold; text-align: center;">failures</div></td><td><div style="font-weight: bold; text-align: center;">发生的所有错误的错误对象数组</div></td></tr></thead><tbody><tr><td>failedKeys</td><td>具有失败删除的键的数组。这个数组的顺序与failures相同，因此failures[i]总是表示failedKeys[i]的失败</td></tr><tr><td>successCount</td><td>成功删除的次数。</td></tr></tbody></table></div><p style="margin-top: 16px; margin-bottom: 16px;">如果要记录错误，但仍要中止事务，则必须将操作封装在transaction（）块中，然后捕获事务。也可以捕获该操作并在catch（）子句中调用transaction.abort（）。</p> 
<h2><span></span><span></span><span></span>查询数据</h2> 
<pre class="prettyprint"><code class="prism language-javascript has-numbering" style="position: unset;"><span class="token keyword">const</span> someFriends <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>friends
    <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">between</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">await</span> db<span class="token punctuation">.</span>friends
    <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">"josephine"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>friend <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Found Josephine"</span><span class="token punctuation">,</span> friend<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">const</span> abcFriends <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>friends
    <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">startsWithAnyOfIgnoreCase</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">await</span> db<span class="token punctuation">.</span>friends
    <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">inAnyRange</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">Infinity</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">modify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>discount<span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">2</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">3</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">4</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">5</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">6</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">7</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">8</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">9</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">10</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">11</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">12</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">13</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">14</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">15</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">16</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">17</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">18</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">19</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">20</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">21</div></li></ul></pre> 
<pre class="prettyprint"><code class="prism language-javascript has-numbering" style="position: unset;"><span class="token keyword">const</span> forbundsKansler <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>friends
    <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'[firstName+lastName]'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Angela"</span><span class="token punctuation">,</span> <span class="token string">"Merkel"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">2</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">3</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">4</div></li></ul></pre> 
<p style="margin-top: 16px; margin-bottom: 16px;">在Dexie2.0中，您可以简单地执行上面的查询：</p> 
<pre class="prettyprint"><code class="prism language-javascript has-numbering" style="position: unset;"><span class="token keyword">const</span> forbundsKansler <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token string">"Angela"</span><span class="token punctuation">,</span>
    lastName<span class="token punctuation">:</span> <span class="token string">"Merkel"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//or</span><span class="token keyword">const</span> forbundsKansler <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token string">"Angela"</span><span class="token punctuation">,</span>
    lastName<span class="token punctuation">:</span> <span class="token string">"Merkel"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">2</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">3</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">4</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">5</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">6</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">7</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">8</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">9</div></li></ul></pre> 
<p style="margin-top: 16px; margin-bottom: 16px;">此查询等于：从firstName='Angela’按姓氏排序的朋友中选择所有</p> 
<pre class="prettyprint"><code class="prism language-javascript has-numbering" style="position: unset;"><span class="token keyword">const</span> angelasSortedByLastName <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>friends
    <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'[firstName+lastName]'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">between</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"Angela"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"Angela"</span><span class="token punctuation">,</span> <span class="token string">"\uffff"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">2</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">3</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">4</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">5</div></li></ul></pre> 
<p style="margin-top: 16px; margin-bottom: 16px;">选择成绩前五的数据</p> 
<pre class="prettyprint"><code class="prism language-javascript has-numbering" style="position: unset;"><span class="token keyword">const</span> best5GameSession <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>gameSessions
    <span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string">"score"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">2</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">3</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">4</div></li></ul></pre> 
<h3><span></span><span></span><span></span>Table.where()</h3> 
<p style="margin-top: 16px; margin-bottom: 16px;">通过创建WhereClause实例开始筛选对象存储。</p> 
<pre class="prettyprint"><code class="prism language-javascript has-numbering" style="position: unset;"><span class="token comment">// Dexie 1.x and 2.x:</span>
table<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>indexOrPrimaryKey<span class="token punctuation">)</span><span class="token comment">// Dexie 2.x only:</span>
table<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>keyPathArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
table<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>keyPath1<span class="token punctuation">:</span> value1<span class="token punctuation">,</span> keyPath2<span class="token punctuation">:</span> value2<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">2</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">3</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">4</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">5</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">6</div></li></ul></pre> 
<p style="margin-top: 16px; margin-bottom: 16px;">Parameters</p> 
<div class="table-box"><table><thead><tr><td><div style="font-weight: bold; text-align: center;"></div></td><td><div style="font-weight: bold; text-align: center;"></div></td></tr></thead><tbody><tr><td>indexOrPrimaryKey: String</td><td>在Version.stores（）中注册的索引或主键的名称。特殊字符串“：id”表示主键。</td></tr><tr><td>keyPathArray</td><td>(Dexie 2.x only)识别要筛选的键槽的字符串。必须与复合索引或主键匹配。</td></tr><tr><td>{keyPath1: value1, keyPath2: value2, …}</td><td>(Dexie 2.x only)过滤准则</td></tr></tbody></table></div><h3><span></span><span></span><span></span>WhereClause</h3> 
<p style="margin-top: 16px; margin-bottom: 16px;">表示索引或主键上的筛选器。</p> 
<h4><span></span>Methods（方法）</h4> 
<h5><span></span>- above()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">返回索引位于给定键之上的对象集合</p> 
<h5><span></span>- aboveOrEqual()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">返回索引高于或等于给定键的对象集合</p> 
<h5><span></span>- anyOf()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">返回一个对象集合，其中索引等于给定数组中的任何键</p> 
<h5><span></span>- anyOfIgnoreCase()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">返回一个对象集合，其中索引与任何给定字符串匹配，忽略大小写差异。</p> 
<h5><span></span>- below()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">返回索引低于给定键的对象集合</p> 
<h5><span></span>- belowOrEqual()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">返回索引低于或等于给定键的对象集合</p> 
<h5><span></span>- between()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">返回索引位于给定边界之间的对象集合</p> 
<h5><span></span>- equals()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">返回索引等于给定键的对象集合</p> 
<h5><span></span>- equalsIgnoreCase()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">返回一个对象集合，其中索引等于给定的字符串键，忽略大小写差异</p> 
<h5><span></span>- inAnyRange()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">返回索引在任何给定范围内的集合。</p> 
<h5><span></span>- noneOf()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">返回一个集合，其中index等于给定数组中任何键以外的任何键</p> 
<h5><span></span>- notEqual()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">返回一个集合，其中index不等于给定值</p> 
<h5><span></span>- startsWith()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">返回一个对象集合，其中索引以给定的字符串键开头</p> 
<h5><span></span>- startsWithAnyOf()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">返回一个对象集合，其中索引以任何给定字符串开头</p> 
<h5><span></span>- startsWithIgnoreCase()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">返回一个对象集合，其中索引以给定的字符串键开头，忽略大小写差异</p> 
<h5><span></span>- startsWithAnyOfIgnoreCase()</h5> 
<p style="margin-top: 16px; margin-bottom: 16px;">返回一个对象集合，其中索引以任何给定字符串开头，忽略大小写差异</p> 
<h2><span></span><span></span><span></span>存储二进制数据</h2> 
<pre class="prettyprint"><code class="prism language-javascript has-numbering" style="position: unset;"><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dexie</span><span class="token punctuation">(</span><span class="token string">"MyImgDb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stores</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    friends<span class="token punctuation">:</span> <span class="token string">"name"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 下载并存储图片</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">downloadAndStoreImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"some-url-to-an-image.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> db<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token string">"David"</span><span class="token punctuation">,</span>
        image<span class="token punctuation">:</span> blob
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">2</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">3</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">4</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">5</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">6</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">7</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">8</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">9</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">10</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">11</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">12</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">13</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">14</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">15</div></li></ul></pre> 
<h2><span></span><span></span><span></span>索引二进制数据（indexDB 2.0）</h2> 
<p style="margin-top: 16px; margin-bottom: 16px;">IndexedDB 2.0包含对索引二进制数据的支持。Chrome和Safari以及部分Firefox支持这个规范（Firefox在使用二进制主键时有一个bug，但是在使用二进制索引时效果很好）。</p> 
<pre class="prettyprint"><code class="prism language-javascript has-numbering" style="position: unset;"><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dexie</span><span class="token punctuation">(</span><span class="token string">"MyImgDb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stores</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    friends<span class="token punctuation">:</span> <span class="token string">"id, name"</span> <span class="token comment">// 使用二进制UUID作为id</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// IndexedDB 2.0 允许索引ArrayBuffer和XXXArray</span><span class="token comment">// (类型化数组，但不是blob)</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">playWithBinaryPrimKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 存储二进制数据:</span>
    <span class="token keyword">await</span> db<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        id<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        name<span class="token punctuation">:</span> <span class="token string">"David"</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 通过二进制搜索检索</span>
    <span class="token keyword">const</span> friend <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>friend<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Found friend: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>friend<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">`Friend not found`</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">}</span><div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">2</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">3</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">4</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">5</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">6</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">7</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">8</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">9</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">10</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">11</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">12</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">13</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">14</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">15</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">16</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">17</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">18</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">19</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">20</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">21</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">22</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">23</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">24</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">25</div></li></ul></pre> 
<h2><span></span><span></span><span></span>事务（Transaction）</h2> 
<p style="margin-top: 16px; margin-bottom: 16px;">一系列操作步骤之中，只要有一步失败，整个事务就都取消，数据库回滚到事务发生之前的状态，不存在只改写一部分数据的情况。</p> 
<pre class="prettyprint"><code class="prism language-javascript has-numbering" style="position: unset;"><span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">'rw'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>db<span class="token punctuation">.</span>friends<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> friend <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">++</span>friend<span class="token punctuation">.</span>age<span class="token punctuation">;</span>
  <span class="token keyword">await</span> db<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>friend<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering"><li style="color: rgb(153, 153, 153);"><div style="clear: both;">1</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">2</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">3</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">4</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">5</div></li><li style="color: rgb(153, 153, 153);"><div style="clear: both;">6</div></li></ul></pre>
                </div><div></div>
                <link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-d7a94ec6ab.css" rel="stylesheet">
                <link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-f1c5feb645.css" rel="stylesheet">
        </div>
    </article></div>
